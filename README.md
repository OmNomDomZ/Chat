
# Интернет-чат

## Описание
Данная программа состоит из двух частей: сервер и клиент. Сервер запускается как отдельное приложение на заданном порту (указывается в конфигурации), а клиент — в виде GUI-приложения, подключающегося к серверу по имени сервера и номеру порта.


Минимальные возможности чата:

1. Регистрация пользователя — каждый участник чата имеет уникальный ник, который указывается при присоединении к серверу.
2. Просмотр списка участников — возможность увидеть текущих участников чата.
3. Отправка сообщений — пользователи могут посылать сообщения в чат, которые видны всем участникам.
4. История сообщений — клиент отображает все сообщения с момента подключения, включая определённое число предыдущих сообщений. Список обновляется в реальном времени.
5. Отображение событий — клиент показывает события подключения и отключения пользователей. Сервер корректно обрабатывает ситуации отключения клиента по таймауту.
6. Логирование — сервер может вести журнал событий (настраивается в конфигурации).
7. TCP/IP — чат работает через этот протокол.
8. XML-протокол — для общения клиента и сервера используется стандартный протокол на основе XML.

## Протокол взаимодействия

В начале каждого сообщения передаются 4 байта (Java int) с его длиной. После этого необходимо прочитать из сокета указанное количество байт и обработать их как XML-документ. Программа должна корректно игнорировать неизвестные сообщения и поля для обеспечения работы с расширениями.

1. Регистрация

    Client message
    ```xml
    <login name="login">
        <name>USER_NAME</name>
        <password>PASSWORD</password>
    </login>
    ```
    Server error answer
    ```xml
    <error>
        <message>REASON</message>
    </error>
    ```
    Server success answer
    ```xml
    <success></success>
    ```
    При первом логине пользователя сервер сохраняет его имя и криптографический хэш пароля. Сам пароль хранить нельзя! При последующих логинах, если хэш передаваемого пароля не совпадает с сохраненным, возвращается сообщение об ошибке, и сервер закрывает соединение.

    Все остальные команды возвращают ошибку, пока не произойдет успешный логин.

2. Запрос списка пользователей чата

    Client message
    ```xml
    <list name="list"></list>
    ```
    Server error answer
    ```xml
    <error>
        <message>REASON</message>
    </error>
    ```
    Server success answer
    ```xml
    <success>
        <users>
            <user>
                <name>USER_1</name>
            </user>
            ...
            <user>
                <name>USER_N</name>
            </user>
        </users>
    </success>
    ```

3. Сообщение от клиента серверу

    Client message
    ```xml
    <CommandMessage name="message">
        <message>MESSAGE</message>
    </CommandMessage>
    ```
    Server error answer
    ```xml
    <error>
        <message>REASON</message>
    </error>
    ```
    Server success answer
    ```xml
    <success></success>
    ```

4. Сообщение от сервера клиенту

    Server message
    ```xml
    <EventMessage name="message">
        <from>CHAT_NAME_FROM</from>
        <message>MESSAGE</message>
    </EventMessage>
    ```

5. Отключение

    Client message
    ```xml
    <logout name="logout"></logout>
    ```
    Server error answer
    ```xml
    <error>
        <message>REASON</message>
    </error>
    ```
    Server success answer
    ```xml
    <success></success>
    ```
    Также отключение происходит автоматически при закрытии клиентом соединения или ошибке соединения. Сервер должен корректно обрабатывать такую ситуацию.

6. Оповещение о новым клиенте (отправляется всем клиентам)

    Server message
    ```xml
    <userlogin name="userlogin">
        <name>USER_NAME</name>
    </userlogin >
    ```

7. Оповещение об отключении клиента (отправляется всем клиентам)

    Server message
    ```xml
    <userlogout name="userlogout">
        <name>USER_NAME</name>
    </userlogout>
    ```